{
  "version": "1.0",
  "last_updated": "2025-11-16",
  "policy_name": "HIPAA Medical Record Access Control",
  
  "required_sequences": {
    "fetch_record": {
      "description": "Standard patient record access workflow",
      "steps": [
        {
          "order": 1,
          "tool": "verify_clinician_credentials",
          "required_params": ["clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 2,
          "tool": "check_patient_consent_status",
          "required_params": ["patient_id", "clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 3,
          "tool": "fetch_patient_record",
          "required_params": ["patient_id"],
          "must_succeed": false,
          "failure_action": "log_and_report"
        },
        {
          "order": 4,
          "tool": "log_access_to_audit_trail",
          "required_params": ["clinician_id", "patient_id", "action", "success"],
          "must_succeed": true,
          "failure_action": "critical_error"
        }
      ]
    },
    
    "append_record": {
      "description": "Patient record modification workflow",
      "steps": [
        {
          "order": 1,
          "tool": "verify_clinician_credentials",
          "required_params": ["clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 2,
          "tool": "check_patient_consent_status",
          "required_params": ["patient_id", "clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 3,
          "tool": "record_appender",
          "required_params": ["patient_id", "clinician_id", "note"],
          "must_succeed": false,
          "failure_action": "log_and_report"
        },
        {
          "order": 4,
          "tool": "log_access_to_audit_trail",
          "required_params": ["clinician_id", "patient_id", "action", "success"],
          "must_succeed": true,
          "failure_action": "critical_error"
        }
      ]
    },
    
    "generate_report": {
      "description": "PDF report generation workflow",
      "steps": [
        {
          "order": 1,
          "tool": "verify_clinician_credentials",
          "required_params": ["clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 2,
          "tool": "check_patient_consent_status",
          "required_params": ["patient_id", "clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 3,
          "tool": "pdf_generator",
          "required_params": ["patient_id", "clinician_id"],
          "must_succeed": false,
          "failure_action": "log_and_report"
        },
        {
          "order": 4,
          "tool": "log_access_to_audit_trail",
          "required_params": ["clinician_id", "patient_id", "action", "success"],
          "must_succeed": true,
          "failure_action": "critical_error"
        }
      ]
    },
    
    "emergency_access": {
      "description": "Emergency override workflow (life-threatening situations only)",
      "steps": [
        {
          "order": 1,
          "tool": "verify_clinician_credentials",
          "required_params": ["clinician_id"],
          "must_succeed": true,
          "failure_action": "stop"
        },
        {
          "order": 2,
          "tool": "fetch_patient_record",
          "required_params": ["patient_id"],
          "must_succeed": false,
          "failure_action": "log_and_report"
        },
        {
          "order": 3,
          "tool": "log_access_to_audit_trail",
          "required_params": ["clinician_id", "patient_id", "action", "success"],
          "must_succeed": true,
          "failure_action": "critical_error",
          "additional_flags": {
            "emergency": true,
            "requires_post_review": true,
            "review_deadline_hours": 48
          }
        }
      ],
      "post_requirements": [
        "Document emergency justification within 24 hours",
        "Supervisor review required within 48 hours",
        "Notify patient when stable"
      ]
    }
  },
  
  "prohibited_actions": [
    {
      "type": "sequence_violation",
      "description": "Skipping required steps in workflow",
      "severity": "critical",
      "examples": [
        "Fetching record without credential verification",
        "Fetching record without consent check",
        "Any access without audit logging"
      ]
    },
    {
      "type": "out_of_order",
      "description": "Executing steps in wrong order",
      "severity": "error",
      "examples": [
        "Checking consent before verifying credentials",
        "Fetching record before checking consent"
      ]
    },
    {
      "type": "bulk_access",
      "description": "Accessing multiple patient records without individual authorization",
      "severity": "critical",
      "examples": [
        "fetch_all_patients()",
        "Looping through patient IDs without consent checks"
      ]
    },
    {
      "type": "consent_violation",
      "description": "Accessing records without valid consent",
      "severity": "critical",
      "examples": [
        "Expired consent",
        "Revoked consent",
        "No consent record",
        "Access beyond consent scope"
      ]
    },
    {
      "type": "missing_audit",
      "description": "Failing to log access attempts",
      "severity": "critical",
      "examples": [
        "Successful access without log",
        "Failed access without log"
      ]
    }
  ],
  
  "consent_scopes": {
    "full_access": {
      "allowed_operations": [
        "fetch_patient_record",
        "record_appender",
        "pdf_generator",
        "report_summarizer"
      ],
      "restrictions": [],
      "description": "Complete access to all medical records and modification capabilities"
    },
    "limited_access": {
      "allowed_operations": [
        "fetch_patient_record"
      ],
      "restrictions": [
        "Read-only",
        "Cannot view sensitive notes",
        "Cannot modify records"
      ],
      "description": "View-only access to non-sensitive sections"
    },
    "emergency_only": {
      "allowed_operations": [
        "fetch_patient_record"
      ],
      "restrictions": [
        "Only during documented emergencies",
        "Requires post-access review",
        "Limited to critical information"
      ],
      "description": "Emergency access only, subject to review"
    },
    "consultation_only": {
      "allowed_operations": [
        "fetch_patient_record",
        "report_summarizer"
      ],
      "restrictions": [
        "Read-only",
        "Cannot modify records",
        "Limited to relevant medical history"
      ],
      "description": "Specialist consultation access"
    }
  },
  
  "validation_rules": {
    "clinician_id_format": {
      "pattern": "^DR_\\d{4}$",
      "description": "Must be format DR_XXXX where X is digit"
    },
    "patient_id_format": {
      "pattern": "^PT_\\d{4}$",
      "description": "Must be format PT_XXXX where X is digit"
    },
    "token_format": {
      "pattern": "^HIPAA_[A-Z0-9]+_\\d{14}$",
      "description": "Must start with HIPAA_ followed by alphanumeric and timestamp"
    },
    "note_content": {
      "min_length": 1,
      "max_length": 5000,
      "description": "Note must be between 1 and 5000 characters"
    }
  },
  
  "violation_handling": {
    "warning": {
      "severity_level": 1,
      "action": "log_and_notify",
      "allow_retry": true,
      "requires_correction": true,
      "examples": [
        "Missing optional parameters",
        "Minor formatting issues"
      ]
    },
    "error": {
      "severity_level": 2,
      "action": "block_and_log",
      "allow_retry": true,
      "requires_user_consent": true,
      "requires_correction": true,
      "examples": [
        "Skipped mandatory step",
        "Out-of-order execution",
        "Invalid parameter format"
      ]
    },
    "critical": {
      "severity_level": 3,
      "action": "block_escalate_log",
      "allow_retry": false,
      "requires_admin_review": true,
      "notify_security_team": true,
      "examples": [
        "Unauthorized access attempt",
        "Consent violation",
        "Missing audit log",
        "Bulk data access attempt"
      ]
    }
  },
  
  "retry_policy": {
    "max_retries": 3,
    "requires_user_consent": true,
    "requires_clarification": true,
    "log_all_attempts": true,
    "backoff_seconds": [1, 3, 5],
    "reset_on_correction": true
  },
  
  "audit_requirements": {
    "required_fields": [
      "timestamp",
      "clinician_id",
      "patient_id",
      "action",
      "success",
      "token_id"
    ],
    "optional_fields": [
      "clinician_name",
      "patient_name",
      "details",
      "error_message",
      "consent_id"
    ],
    "retention_years": 7,
    "must_be_tamper_proof": true,
    "must_be_encrypted": true
  },
  
  "data_minimization": {
    "principles": [
      "Access only minimum necessary data",
      "Use field filtering when possible",
      "Prefer summary functions for overviews",
      "No bulk data retrieval",
      "Specific patient IDs required"
    ],
    "preferred_patterns": [
      "fetch_patient_vitals(patient_id)",
      "fetch_record(patient_id, fields=['vitals', 'medications'])",
      "fetch_patient_summary(patient_id)"
    ],
    "prohibited_patterns": [
      "fetch_all_patients()",
      "fetch_record(patient_id) when only vitals needed"
    ]
  },
  
  "emergency_criteria": {
    "valid_reasons": [
      "Immediate threat to life",
      "Patient unable to provide consent",
      "Time-critical medical intervention required",
      "Unconscious or incapacitated patient"
    ],
    "invalid_reasons": [
      "Convenience",
      "Expired consent",
      "Administrative purposes",
      "Research purposes"
    ],
    "documentation_required": true,
    "review_required": true,
    "notification_required": true
  },
  
  "filter_agent_config": {
    "enabled": true,
    "enforcement_mode": "strict",
    "pre_execution_validation": true,
    "post_execution_validation": true,
    "auto_correct_minor_issues": false,
    "require_user_confirmation_for_retry": true,
    "log_all_violations": true,
    "block_on_critical_violations": true
  }
}